<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Function Solutions Counter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .controls {
      text-align: center;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      margin: 0 10px;
      cursor: pointer;
      border: 2px solid #007bff;
      background: white;
      color: #007bff;
    }
    button.active {
      background: #007bff;
      color: white;
    }
    .slider-container {
      text-align: center;
      margin: 20px 0;
    }
    .slider-container input {
      width: 300px;
      margin: 0 10px;
    }
    .solutions {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0;
    }
    #canvas {
      border: 1px solid #ccc;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="btnF" class="active" onclick="selectFunction('f')">Function f</button>
    <button id="btnG" onclick="selectFunction('g')">Function g</button>
    <button id="btnH" onclick="selectFunction('h')">Function h</button>
  </div>
  
  <div class="slider-container">
    <label>k = </label>
    <input type="range" id="kSlider" min="-2" max="3" step="0.1" value="0">
    <span id="kValue">0.0</span>
  </div>
  
  <div class="solutions" id="solutions">
    Solutions: 1
  </div>
  
  <canvas id="canvas" width="800" height="500"></canvas>

  <script>
    let currentFunction = 'f';
    let currentK = 0.0;
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    function linspace(start, stop, n) {
      const arr = [], step = (stop - start)/(n-1);
      for (let i=0; i<n; i++) arr.push(start + i*step);
      return arr;
    }
    
    function getFunctionData(func) {
      if (func === 'f') {
        const x = linspace(-1, 2, 300);
        const y = x.map(x => -2 + 5*Math.pow((x+1)/3, 1.5));
        return {x, y};
      } else if (func === 'g') {
        const xg1 = linspace(-1, 0, 150);
        const yg1 = xg1.map(x => 3 - 3*Math.pow(1 + x, 0.5));
        const xg2 = linspace(0, 1, 100);
        const yg2 = xg2.map(x => Math.pow(x, 0.7));
        const xg3 = linspace(1, 2, 150);
        const yg3 = xg3.map(x => 1 - 3*Math.pow(x-1, 1.2));
        return {
          x: [...xg1, ...xg2, ...xg3],
          y: [...yg1, ...yg2, ...yg3]
        };
      } else if (func === 'h') {
    // Piecewise linear with jump at x=0: h(x) = -2+2x for x∈[-1,0], then h(x)=1+x for x∈(0,2]
    const x1 = linspace(-1, 0, 150);
    const y1 = x1.map(x => -2 + 2*x);

    const x2 = linspace(0.0001, 2, 200);  // start just right of 0 to avoid duplicate x=0
    const y2 = x2.map(x => 1 + x);

    return {
        x: [...x1, ...x2],
        y: [...y1, ...y2]
    };
}
    }
    
    function toCanvasX(x) {
      return ((x + 1.5) / 4) * canvas.width;
    }
    
    function toCanvasY(y) {
      return canvas.height - ((y + 3) / 6) * canvas.height;
    }
    
    function countIntersections(data, k) {
      const {x, y} = data;
      let count = 0;
      
      for (let i = 0; i < y.length - 1; i++) {
        // Check if horizontal line y=k crosses between two consecutive points
        if ((y[i] < k && y[i+1] > k) || (y[i] > k && y[i+1] < k)) {
          count++;
        }
        // Also check if k equals a point exactly
        else if (y[i] === k) {
          count++;
        }
      }
      
      // Check the last point
      if (y[y.length - 1] === k) {
        count++;
      }
      
      return count;
    }
    
    function drawGrid() {
      ctx.strokeStyle = '#e0e0e0';
      ctx.lineWidth = 1;
      
      // Vertical grid lines
      for (let x = -1; x <= 2; x += 0.5) {
        const canvasX = toCanvasX(x);
        ctx.beginPath();
        ctx.moveTo(canvasX, 0);
        ctx.lineTo(canvasX, canvas.height);
        ctx.stroke();
      }
      
      // Horizontal grid lines
      for (let y = -2; y <= 3; y += 0.5) {
        const canvasY = toCanvasY(y);
        ctx.beginPath();
        ctx.moveTo(0, canvasY);
        ctx.lineTo(canvas.width, canvasY);
        ctx.stroke();
      }
      
      // Axes
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      
      // X-axis
      const yZero = toCanvasY(0);
      ctx.beginPath();
      ctx.moveTo(0, yZero);
      ctx.lineTo(canvas.width, yZero);
      ctx.stroke();
      
      // Y-axis
      const xZero = toCanvasX(0);
      ctx.beginPath();
      ctx.moveTo(xZero, 0);
      ctx.lineTo(xZero, canvas.height);
      ctx.stroke();
    }
    
    function drawFunction(data) {
      const {x, y} = data;
      
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 3;
      ctx.beginPath();
      
      for (let i = 0; i < x.length; i++) {
        const canvasX = toCanvasX(x[i]);
        const canvasY = toCanvasY(y[i]);
        
        if (i === 0) {
          ctx.moveTo(canvasX, canvasY);
        } else {
          ctx.lineTo(canvasX, canvasY);
        }
      }
      
      ctx.stroke();
    }
    
    function drawHorizontalLine(k) {
      ctx.strokeStyle = 'blue';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      
      const canvasY = toCanvasY(k);
      ctx.beginPath();
      ctx.moveTo(0, canvasY);
      ctx.lineTo(canvas.width, canvasY);
      ctx.stroke();
      
      ctx.setLineDash([]);
    }
    
    function selectFunction(func) {
      currentFunction = func;
      
      // Update button styles
      document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('btn' + func.toUpperCase()).classList.add('active');
      
      updatePlot();
    }
    
    function updatePlot() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw grid
      drawGrid();
      
      // Get function data
      const data = getFunctionData(currentFunction);
      
      // Draw function
      drawFunction(data);
      
      // Draw horizontal line
      drawHorizontalLine(currentK);
      
      // Count intersections
      const intersections = countIntersections(data, currentK);
      document.getElementById('solutions').innerHTML = `Solutions: ${intersections}`;
    }
    
    // Slider event listener
    document.getElementById('kSlider').addEventListener('input', function() {
      currentK = parseFloat(this.value);
      document.getElementById('kValue').textContent = currentK.toFixed(1);
      updatePlot();
    });
    
    // Initialize
    updatePlot();
  </script>
</body>
</html>
